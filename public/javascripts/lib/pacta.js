!function(a,b,c){"use strict";"object"==typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("Promise",this,function(){"use strict";var a,b,c,d,e;return e="function"!=typeof Array.prototype.reduce?function(a,b,c){var d,e,f=a.length,g=!1;for(arguments.length>2&&(e=c,g=!0),d=0;f>d;d+=1)a.hasOwnProperty(d)&&(g?e=b(e,a[d],d,a):(e=a[d],g=!0));return e}:function(a){return Array.prototype.reduce.apply(a,[].slice.call(arguments,1))},a="object"==typeof process&&process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},b="function"==typeof Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length,e=-1,f=!1;d>c&&!f;)a[c]===b&&(e=c,f=!0),c+=1;return e},c=function(){this.events={}},c.prototype.on=function(a,b){"object"!=typeof this.events[a]&&(this.events[a]=[]),this.events[a].push(b)},c.prototype.removeListener=function(a,c){var d;"object"==typeof this.events[a]&&(d=b(this.events[a],c),d>-1&&this.events[a].splice(d,1))},c.prototype.emit=function(a){var b,c,d,e=[].slice.call(arguments,1);if("object"==typeof this.events[a])for(c=this.events[a].slice(),d=c.length,b=0;d>b;b+=1)c[b].apply(this,e)},c.prototype.once=function(a,b){this.on(a,function c(){this.removeListener(a,c),b.apply(this,arguments)})},d=function(a){this.emitter=new c,this.resolved=!1,this.rejected=!1,arguments.length&&this.resolve(a)},d.prototype.resolve=d.prototype.fulfill=function(a){"pending"===this.state()&&(this.value=a,this.resolved=!0,this.emitter.emit("resolved",a))},d.prototype.reject=function(a){"pending"===this.state()&&(this.reason=a,this.rejected=!0,this.emitter.emit("rejected",a))},d.prototype.state=function(){var a;return a=this.resolved?"fulfilled":this.rejected?"rejected":"pending"},d.prototype.onRejected=function(b){var c=new d,e=this.reason;return this.rejected?a(function(){try{c.resolve(b(e))}catch(a){c.reject(a)}}):this.emitter.once("rejected",function(d){a(function(){try{c.resolve(b(d))}catch(a){c.reject(a)}})}),c},d.prototype.map=function(b){var c=new d,e=this.reason,f=this.value;return this.resolved?a(function(){try{c.resolve(b(f))}catch(a){c.reject(a)}}):this.rejected?a(function(){c.reject(e)}):(this.emitter.once("resolved",function(d){a(function(){try{c.resolve(b(d))}catch(a){c.reject(a)}})}),this.emitter.once("rejected",function(b){a(function(){c.reject(b)})})),c},d.prototype.mapError=function(b){var c=new d,e=this.reason,f=this.value;return this.resolved?a(function(){c.resolve(f)}):this.rejected?a(function(){try{c.reject(b(e))}catch(a){c.reject(a)}}):(this.emitter.once("resolved",function(b){a(function(){c.resolve(b)})}),this.emitter.once("rejected",function(d){a(function(){try{c.reject(b(d))}catch(a){c.reject(a)}})})),c},d.prototype.chain=function(a){var b=new d;return this.map(a).map(function(a){a.map(function(a){b.resolve(a)}),a.onRejected(function(a){b.reject(a)})}),this.onRejected(function(a){b.reject(a)}),b},d.prototype.chainError=function(a){var b=new d;return this.mapError(a).mapError(function(a){a.map(function(a){b.resolve(a)}),a.onRejected(function(a){b.reject(a)})}),this.map(function(a){b.resolve(a)}),b},d.prototype.concat=function(a){var b=new d;return this.map(function(c){a.map(function(a){b.resolve(c.concat(a))})}),this.onRejected(function(a){b.reject(a)}),a.onRejected(function(a){b.reject(a)}),b},d.prototype.ap=function(a){return this.chain(function(b){return a.map(b)})},d.prototype.empty=function(){return d.of(this.value.empty?this.value.empty():this.value.constructor.empty())},d.prototype.conjoin=function(a){var b=function(a){return[].concat(a)};return this.map(b).concat(a.map(b))},d.prototype.append=function(a){return this.concat(a.map(function(a){return[a]}))},d.prototype.spread=d.prototype.explode=function(a){return this.map(function(b){return a.apply(null,b)})},d.prototype.reduce=function(){var a=[].slice.call(arguments);return this.map(function(b){return e.apply(null,[b].concat(a))})},d.prototype.then=function(a,b){var c=new d;return this.map("function"==typeof a?function(b){try{var e=a(b);d.resolve(c,e)}catch(f){c.reject(f)}}:function(a){c.resolve(a)}),this.onRejected("function"==typeof b?function(a){try{var e=b(a);d.resolve(c,e)}catch(f){c.reject(f)}}:function(a){c.reject(a)}),c},d.resolve=function(a,b){var c,e=!1;if(a===b)a.reject(new TypeError("Promises/A+ 2.3.1. If promise and x refer to the same object, reject promise with a TypeError as the reason."));else if(null===b||"object"!=typeof b&&"function"!=typeof b)a.resolve(b);else try{if(c=b.then,"function"==typeof c)try{c.call(b,function(b){e||(d.resolve(a,b),e=!0)},function(b){e||(a.reject(b),e=!0)})}catch(f){e||a.reject(f)}else a.resolve(b)}catch(f){a.reject(f)}},d.of=function(a){return new d(a)},Array.empty=function(){return[]},String.empty=function(){return""},d});